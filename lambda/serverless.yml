service: test-plan-generator-jira

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  region: ${opt:region, 'eu-west-1'}
  stage: ${opt:stage, 'dev'}
  memorySize: 512
  timeout: 30
  
  environment:
    AWS_NODEJS_CONNECTION_REUSE_ENABLED: '1'
    NODE_OPTIONS: '--enable-source-maps'
    JIRA_URL: ${env:JIRA_URL, 'https://your-domain.atlassian.net'}
    JIRA_EMAIL: ${env:JIRA_EMAIL, 'your-email@example.com'}
    JIRA_API_TOKEN: ${env:JIRA_API_TOKEN, 'YOUR_JIRA_API_TOKEN_HERE'}
  
  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:PutLogEvents
          Resource: 
            - 'arn:aws:logs:${self:provider.region}:*:log-group:/aws/lambda/*:*'

functions:
  jiraIntegration:
    handler: src/index.handler
    description: Main handler for Jira integration
    events:
      - http:
          path: /jira/import
          method: post
          cors: true
      - http:
          path: /jira/issues
          method: post
          cors: true
      - http:
          path: /jira/import
          method: options
          cors: true
      - http:
          path: /jira/issues
          method: options
          cors: true

  jiraImport:
    handler: src/handlers/jiraImport.handler
    description: Import Jira issues based on filters
    events:
      - http:
          path: /import
          method: post
          cors: true

  getIssues:
    handler: src/handlers/getIssues.handler
    description: Get specific Jira issues by keys
    events:
      - http:
          path: /issues
          method: post
          cors: true

plugins:
  - serverless-offline

custom:
  serverless-offline:
    httpPort: 3001
    lambdaPort: 3002

package:
  individually: false
  patterns:
    - '!tests/**'
    - '!.git/**'
    - '!*.md'
    - '!jest.config.js'
    - 'src/**'
    - 'node_modules/**'
